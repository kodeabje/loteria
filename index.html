<!DOCTYPE html>
<html>
<head>
    <title>Loter&iacute;a Mexicana</title>
    <style>

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
        }

        #instructionOverlay {
            position: fixed; /* Overlay takes the whole screen */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent background */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000; /* Make sure it's on top of everything */
        }

        .instructionContent {
            background-color: white;
            padding: 20px;
            text-align: center;
            max-width: 80%; /* Adjust as needed */
            max-height: 80%; /* Adjust as needed */
            overflow-y: auto; /* Allows scrolling within the content if needed */
        }

        #startButton {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }     
        
        
        #container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around; /* Distributes space evenly */
            padding: 1vw; /* Responsive padding */
        }

        #card {
            height: calc(85% - 4vw); /* Subtracting margin from total height */
            width: 95%; /* Adjust width */
            cursor: pointer;
            object-fit: contain;
            margin: 2vw; /* Responsive margin */
        }

        #loteriaButton {
            height: calc(10% - 4vw); /* Subtracting margin from total height */
            width: 95%; /* Adjust width */
            padding: 10px 20px;
            font-size: 4vh;
            cursor: pointer;
            box-sizing: border-box;
            margin: 2vw; /* Responsive margin */
        }

        /* Media query for larger screens */
        @media (min-width: 768px) {
            #loteriaButton {
                height: 50px; /* Fixed height for larger screens */
            }
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
</head>

<body>

    <div id="instructionOverlay">
        <div class="instructionContent">
            <p>Instructions go here...</p>
            <button id="startButton">Listo</button>
        </div>
    </div>

    <div id="container">
        <img src="cards/0.jpg" alt="Lotería card" id="card">
        <button id="loteriaButton">¡Loteria!</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const startButton = document.getElementById('startButton');
            const instructionOverlay = document.getElementById('instructionOverlay');
            const cardElement = document.getElementById('card');

            startButton.addEventListener('click', () => {
                instructionOverlay.style.display = 'none';
                handleCardInteraction(); // Simulate a card click to start the game
            });

            const loteriaCards = [
                "1 el gallo", "2 el diablito", "3 la dama", "4 el catrin", "5 el paraguas",
                "6 la sirena", "7 la escalera", "8 la botella", "9 barril", "10 arbol",
                "11 melon", "12 el valiente", "13 el gorrito", "14 la muerte", "15 la pera",
                "16 la bandera", "17 el bandolon", "18 el violoncello", "19 la garza", "20 el pajaro",
                "21 la mano", "22 la bota", "23 la luna", "24 el cotorro", "25 el borracho",
                "26 el negrito", "27 el corazon", "28 la sandia", "29 el tambor", "30 el camaron",
                "31 las jaras", "32 el musico", "33 la arana", "34 el soldado", "35 la estrella",
                "36 el cazo", "37 el mundo", "38 el apache", "39 el nopal", "40 el alacran",
                "41 la rosa", "42 la calavera", "43 la campana", "44 el cantarito", "45 el venado",
                "46 el sol", "47 la corona", "48 la chalupa", "49 el pino", "50 el pescado",
                "51 la palma", "52 la maceta", "53 el arpa", "54 la rana"
            ];

            let shownCards = new Set();
            //const cardElement = document.getElementById('card');
            let gameEnded = false;

            function playSound(randomCard) {
                const audio = new Audio(`audio/${randomCard}.mp3`);
                audio.play().catch(e => console.error("Error playing audio:", e));
            }

            function getRandomCard() {
                if (loteriaCards.length === 0) {
                    return null;
                }
                const randomIndex = Math.floor(Math.random() * loteriaCards.length);
                return loteriaCards.splice(randomIndex, 1)[0];
            }

            function resetGame() {
                loteriaCards.push(...shownCards);
                shownCards.clear();
                gameEnded = false;
                cardElement.src = `cards/0.jpg`;
            }

            function handleCardInteraction() {
                if (gameEnded) {
                    resetGame();
                    return;
                }

                const randomCard = getRandomCard();
                if (randomCard) {
                    shownCards.add(randomCard);
                    cardElement.src = `cards/${randomCard}.jpg`;
                    playSound(randomCard); // Play sound for the card
                } else {
                    cardElement.src = `cards/99.svg`;
                    gameEnded = true;
                    triggerConfetti();
                }
            }

            cardElement.addEventListener('click', handleCardInteraction);

            document.addEventListener('keydown', (event) => {
                if ((event.key === 'Enter' || event.key === ' ') && document.activeElement !== loteriaButton) {
                    handleCardInteraction();
                }
            });

            function triggerConfetti() {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }
 
            function playWinSound() {
                const winAudio = new Audio('audio/win.wav');
                winAudio.play().catch(e => console.error('Error playing win sound:', e));
            }

            const loteriaButton = document.getElementById('loteriaButton');
                loteriaButton.addEventListener('click', () => {
                    if (!gameEnded) {
                        triggerConfetti();
                        playWinSound(); // Corrected this line to directly call playWinSound
                        gameEnded = true;
                        setTimeout(resetGame, 3000); // Resets the game after 3 seconds
                    }
            });

        });
    </script>

</body>
</html>
